---
import CustomLabel from "../components/CustomLabel.astro";
---

<style>

.background-img {
  background-image: url("/background.png");
  image-rendering: pixelated;
  background-size: cover;
  background-repeat: no-repeat;
  z-index: 0;
}

.cables-img {
  background-image: url("/cables.png");
  background-size: cover;
  background-repeat: no-repeat;
  z-index: 2;
  cursor: none;
  pointer-events: none;
}

.gun-img {
  background-image: url("/gun.png");
  background-size: contain;
  image-rendering: pixelated;
  background-repeat: round;
  position: absolute;
  height: 100vh;
  width: 100px;
  overflow: hidden;
  z-index: 2;
}

.background {
  background-position: center; 
  position: absolute;
  left: 0;
  top: 0;
  width: 100vw;
  height: 100%;
  transition: transform 0s linear;
  overflow: hidden;
}

.overlay {
  background-image: url("/background-gradient.png");
  background-size: cover;
  background-repeat: no-repeat;
  z-index: 1;
}

</style>

<script type="module">
  import { cursorData } from "/stores/app.js";

  const overlay = document.querySelector(".overlay");

  let scaleUniform = 0;

  function easeInSine(x) {
    return 1 - Math.cos((x * Math.PI) / 2);
  }

  const applySize = (size) => {
    const eased = easeInSine(size) * 2/3 + size * 1/3;
    document.querySelector(".overlay").style.transform = 'scale(' + (1 + eased * 6) + ')';
    document.querySelector(".background-img").style.transform = 'scale(' + (1 + eased * 2) + ')';
  }

  let direction = 0;
  let animationId = null;

  const updateSize = () => {
    if (direction == 1) {
      if (scaleUniform > 1.0) {
        scaleUniform = 1;
        direction = 0;
      } else {
        const wasOver = scaleUniform < 0.3;
        scaleUniform += 0.0005;

        if (scaleUniform > 0.3 && wasOver == false) {
          cursorData.setMode('door');
        }
      }
    } else if (direction == -1) {
      if (scaleUniform < 0.0) {
        scaleUniform = 0;
        direction = 0;
      } else {
        scaleUniform -= 0.0005;
      }
    }

    applySize(scaleUniform);

    if (direction == 0) {
      animationId = null;
    } else {
      requestAnimationFrame(updateSize);
    }
  }

  overlay.addEventListener("mouseover", async () => {
    direction = 1;
    if (!animationId) {
      animationId = requestAnimationFrame(updateSize);
    }
  })

  overlay.addEventListener("mouseleave", async () => {
    cursorData.setMode('cursor');
    direction = -1;
    if (!animationId) {
      animationId = requestAnimationFrame(updateSize);
    }
  })

  overlay.addEventListener("mousedown", async () => {
    if (cursorData.getMode() == 'door') {
      window.location.href = "/depths/index.html";
    }
  })


</script>

<div class="background overlay"/>
<div class="background background-img"/>
<div class="background cables-img" />
<div
  class="gun-img"
  style="right: 5px;"
/>
<CustomLabel mousetracked={true} text="Peace Activist Has To Admit Barrett .50 Caliber Sniper Rifle Is Pretty Cool"/>
<div
  class="gun-img"
  style="
  left: 5px;
  transform: scaleX(-1);
  "
/>
<CustomLabel mousetracked={true} text="Peace Activist Has To Admit Barrett .50 Caliber Sniper Rifle Is Pretty Cool"/>
