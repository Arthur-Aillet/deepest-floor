<img class="custom-cursor" src="cursor.svg" data-cursor />

<style>

.custom-cursor {
  position: fixed;
  z-index: 1000;
  pointer-events: none;
}

</style>
<script type="module">
  import { cursorData } from "/stores/app.js";

  let mode = 'cursor';
  let killAngle = false;

  cursorData.setMode = (newMode) => {
    const cursor = document.querySelector(".custom-cursor");

    if (newMode == mode) {
      return;
    }

    mode = newMode;
    if (mode == 'cursor') {
      cursor.src = 'cursor.svg';
      killAngle = false;
      requestAnimationFrame(updateAngle);
    } else if (mode == 'door'){
      console.log('change');
      killAngle = true;
      cursor.style.transform = 'rotate(0deg) scale(100%)';
      cursor.style.transition = '',
      cursor.src = 'door-icon.png';
    }
  }

  document.addEventListener("mousemove", (e) => {
    const cursor = document.querySelector(".custom-cursor");
    cursor.style.left = `${e.clientX - 20.5}px`;
    cursor.style.top = `${e.clientY - 20.5}px`;

    if (e.target.nodeType === Node.ELEMENT_NODE) {
      const cursorType = getComputedStyle(e.target).cursor;
      if (cursorType != "none") {
        cursor.style.display = "none";
      } else {
        cursor.style.display = "inherit";
      }
    }
  });

  let updateAngle = () => {
    if (mode == 'cursor' && killAngle == false) {
      cursorData.angle += 2;
      document.querySelector("[data-cursor]").style.transform = `rotate(${cursorData.angle}deg) scale(100%)`;
      if (cursorData.animate == true) {
        requestAnimationFrame(updateAngle);
      }
    }
  };

  requestAnimationFrame(updateAngle);

  cursorData.lockCursor = () => {
    if (mode == 'cursor') {
      cursorData.animate = false;
      const cursor = document.querySelector(".custom-cursor");
      cursorData.angle = Math.floor(cursorData.angle / 90) * 90 - 1;
      cursor.style.transition =
        "transform 0.4s linear(0, 0.012 0.6%, 0.047 1.2%, 0.186 2.5%, 0.387 3.8%, 0.948 7%, 1.186 8.7%, 1.278 9.6%, 1.338 10.4%, 1.378 11.2%, 1.398 12.1%, 1.398 12.7%, 1.387 13.4%, 1.331 14.8%, 1.253 16.1%, 1.022 19.4%, 0.922 21.2%, 0.865 22.8%, 0.842 24.4%, 0.844 25.6%, 0.86 26.8%, 1.023 33.2%, 1.052 35%, 1.063 36.8%, 1.056 39.2%, 0.992 45.5%, 0.975 49.1%, 1.01 61.4%, 0.996 73.6%, 1)";
      setTimeout(() => {
        cursor.style.transform = `rotate(${cursorData.angle}deg) scale(90%)`;
      }, 400);
    }
  }

  cursorData.unlockCursor = () => {
    if (mode == 'cursor') {
      cursorData.animate = true;
      requestAnimationFrame(updateAngle);
    }
  }
</script>
